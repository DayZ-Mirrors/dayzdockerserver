version: "3.3"

volumes:
  # For steamcmd files and resource files used by the scripts
  homedir_main:
  # For workshop.cfg, for now
  homedir_server:
  # Where the server files will be installed
  serverfiles:
  # Server profile files
  profiles:
  # Server maps
  mpmissions:
  # Mods
  mods:

services:

  main:
    build: web
    volumes:
      - homedir_main:/home/user
      - serverfiles:/serverfiles
      - mods:/serverfiles/steamapps/workshop/content
      - mpmissions:/serverfiles/mpmissions
      - ./files:/files
      - ./web/bin/dz:/usr/local/bin/dz
      - ./web:/web
    ports:
      - "8000:8000/tcp"
    restart: no

  server:
    build: server
    volumes:
      - homedir_server:/home/user
      - serverfiles:/serverfiles:ro
      - mods:/serverfiles/steamapps/workshop/content:ro
      - mpmissions:/serverfiles/mpmissions
      - profiles:/profiles
      - ./files:/files
      - ./server/bin/dz:/usr/local/bin/dz
    # To have the server show up in the LAN tab of the DayZ launcher,
    # it must run under host mode.
    network_mode: host
    # The above is mutually exclusive with the below. If you don't need
    # the server to show up on the LAN, comment out the network_mode above
    # and uncomment the port mappings below.
#    ports:
#       # Game port
#      - 2302:2302/udp
#       # RCON port
#      - 2302:2302/udp
#       # Steam port
#      - 27016:27016/udp
    # Always restart, unless stopped
    restart: unless-stopped
    # Allows attaching a debugger from the host
    cap_add:
      - SYS_PTRACE
    # Allows core files to be created within the container. These are VERY LARGE! Enable only for debugging!
    ulimits:
      core:
        soft: -1
        hard: -1
